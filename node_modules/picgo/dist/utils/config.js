"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const lowdb_1 = __importDefault(require("lowdb"));
const lodash_id_1 = __importDefault(require("lodash-id"));
const FileSync_1 = __importDefault(require("lowdb/adapters/FileSync"));
const getConfig = (configPath) => {
    const adapter = new FileSync_1.default(configPath, {
        deserialize: (data) => {
            return (new Function(`return ${data}`))();
        }
    });
    const db = lowdb_1.default(adapter);
    db._.mixin(lodash_id_1.default);
    if (!db.has('picBed').value()) {
        db.set('picBed', {
            current: 'smms'
        }).write();
    }
    if (!db.has('picgoPlugins').value()) {
        db.set('picgoPlugins', {}).write();
    }
    return db;
};
exports.getConfig = getConfig;
const saveConfig = (configPath, config) => {
    const db = getConfig(configPath);
    Object.keys(config).forEach((name) => {
        db.read().set(name, config[name]).write();
    });
};
exports.saveConfig = saveConfig;
